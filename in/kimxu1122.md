title: Https的使用（一）
summary:Android中使用Https
authors: Kimxu
publish_date: 2016-11-22
categories: 技术
tags: Android
      Https
      

# 概述

``` 
现在网络安全逐渐成为关注的焦点，尤其是现在移动终端是日渐普及...
说句题外话，这是本博客的第一篇文章，自己原来有两个博客，第一个是Workpress搭建的，第二
个是Github上使用Hexo主题搭建的静态博客。这是我的第三个博客，前两个博客是自己的好朋友
Xuri大神帮忙搭建的，但是当时自己比较浮躁，写了几篇博客也没有坚持下去。现在这个博客是
用Flask+Bootstrap+AngularJs搭建的。刚开始的时候一度想要放弃，还好最后坚持了下来。
虽然中间遇到了很多坑，但也学到了很多东西，生命在于折腾。等下个月就把自己原来的域名重新
申请回来。每周坚持写一篇精品文章，也算是给自己的努力一个交代。
```
正好工作中需要使用到Https，趁此机会自己也好好的补充了Https方面的知识。这是第一篇，网络
上分析的文章一堆一堆的，我主要是把自己用到的技术和编码发出来。

#  Https 简介
![](http://7xotfz.com1.z0.glb.clouddn.com/public/16-11-22/29594127.jpg)

区别就是多了ssl(tsl已经是很久之前的了，ssl和tsl的区别很小)层，这一层的主要原理就是：
1.当浏览器要与服务器通讯的时候，先和服务器建立安全连接（这一层就是SSL）。
2.浏览器给服务器发送消息（其中夹杂着浏览器的可以使用的加密算法），服务器根据浏览器可以
使用加密算法和Hash算法，以证书的形式返回给浏览器(其中证书里面包含网站的host，和公钥以及证书的颁发机构)。
`非对称加密算法：公钥加密的内容一定要使用私钥才能够解密，同理私钥加密的内容一定要使用公钥才能够解密`
3.浏览器收到服务器返回的消息之后:
    1.会先验证下证书是否合法（浏览器里面存放着一些可信任的颁发机构,如果服务器返回的证书
    是这些可信任的颁发机构颁发的证书，那么这个证书就是合法的，当然也可以自己添加证书放
    到浏览器中）。浏览器会随机产生一串序列号，使用服务器发来的公钥进行加密。
    2.然后使用使用服务器挑选的Hash算法，将刚才的消息使用刚才的序列号进行加密，生成相应的
    消息校验值，与刚才的消息一同发还给服务器。
5.服务器收到消息之后:
    1.使用私钥解密浏览器中使用公钥加密的消息,得到客户端产生的随机序列号。
    2.使用该随机序列号，对该消息进行加密，验证的到的校验值是否与客户端发来的一致。
    如果一致则说明消息未被篡改，可以信任。
    3.最后，使用该随机序列号，加上之前浏览器选择的加密算法，加密一段握手消息，发还给浏览器。
    同时Hash值也带上。
6.浏览器收到消息之后：
    1.计算HASH值是否与发回的消息一致。
    2.检查消息是否为握手消息。
握手结束后，浏览器和服务器端使用握手阶段产生的随机数以及挑选出来的算法进行对称加解密的传输。
`为什么不直接使用非对称加密，而要这么费事，是因为非对称加密耗费时间，对称加密的效率比非对称
加密的效率高的多`
```
    非对称加密算法：RSA, DSA/DSS
    对称加密算法： AES, 3DES
    HASH算法：MD5, SHA1, SHA256
```

# Android中使用Https

上述的原理中，很容易被中间人攻击（Mac上使用Charles，Windows上使用Finder。在浏览器中安装证书
，就可以实现中间人拦截）。
Android中使用Https有几种方式
1.使用证书，之后在App里面存放证书，每次进行Https通讯的时候进行证书比对。
2.使用公钥链的Hash值，把证书中的公钥提取出来，存放到App中，每次连接进行hash值的比对。

时间比较紧，今天就先写这一点，等这周末把代码整理下放上来。